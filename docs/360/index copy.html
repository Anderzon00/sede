 <!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tour Virtual | Sede Regional Túquerres</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />

  <style>
    :root {
      --brand-green: #009640;
      --brand-yellow: #ffc933;
      --bg: radial-gradient(circle at top left, #fffbe6, #f5fff9);
      --surface: #ffffff;
      --muted: #4b5563;
      --text: #111827;
      --topbar-h: 64px;
    }

    * { box-sizing: border-box; }

    html, body {
      height: 100%;
      margin: 0;
      font-family: "Montserrat", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
    }

    /* TOPBAR */
    .topbar {
      position: fixed;
      inset: 0 0 auto 0;
      height: var(--topbar-h);
      z-index: 1040;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1rem;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(0, 0, 0, .04);
    }

    .brand {
      display: flex; gap: .6rem; align-items: center; font-weight: 700;
      color: var(--brand-green); text-transform: uppercase; font-size: .95rem;
    }

    .brand-badge {
      width: 36px; height: 36px; border-radius: 10px;
      background: linear-gradient(135deg, var(--brand-yellow), var(--brand-green));
      display: inline-flex; align-items: center; justify-content: center;
      color: white; font-weight: 800;
    }

    #btnMenu {
      width: 44px; height: 44px; border-radius: 12px; background: var(--brand-yellow);
      display: flex; align-items: center; justify-content: center; border: none;
      cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* PANORAMA */
    #panoramaWrap {
      position: relative; width: 100%; height: calc(100vh - var(--topbar-h)); margin-top: var(--topbar-h);
    }
    #panorama { width: 100%; height: 100%; background-color: #eee; }

    /* PANTALLA BIENVENIDA */
    #welcome {
      position: fixed; inset: var(--topbar-h) 0 0 0; z-index: 1030;
      display: grid; place-items: center; background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(10px);
    }
    .welcome-card {
      width: min(420px, 95vw); background: white; padding: 40px;
      border-radius: 24px; text-align: center; box-shadow: 0 32px 80px rgba(0, 0, 0, 0.15);
    }
    .btn-enter {
      margin-top: 24px; border-radius: 999px; padding: 12px 30px;
      background: var(--brand-yellow); border: none; font-weight: 800;
      color: #111; cursor: pointer; box-shadow: 0 10px 20px rgba(255, 201, 51, 0.3);
    }

    /* CONTROLES INFERIORES */
    #bottomControls {
      position: absolute; left: 0; right: 0; bottom: 20px; z-index: 1050;
      text-align: center; pointer-events: none;
    }
    .ctrl-btn {
      pointer-events: auto; display: inline-flex; align-items: center; gap: 8px;
      border-radius: 999px; padding: 10px 20px; font-weight: 700;
      border: 1px solid rgba(0,0,0,0.1); background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin: 0 5px; transition: all 0.2s;
    }
    #btnBackBottom { background: var(--brand-yellow); color: #000; display: none; }

    /* HOTSPOTS */
    .custom-image-hotspot img {
      width: 48px; height: 48px; transition: transform 0.3s; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    .hotspot-label {
      background: rgba(255,255,255,0.9); padding: 4px 12px; border-radius: 20px;
      font-size: 13px; font-weight: 700; margin-top: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      opacity: 0; transition: opacity 0.3s; pointer-events: none;
    }
    .custom-image-hotspot:hover .hotspot-label { opacity: 1; }

    /* MENU LATERAL (OFFCANVAS) */
    .offcanvas { width: 340px !important; }
    .scene-btn {
      display: flex; justify-content: space-between; align-items: center; width: 100%;
      padding: 12px; margin-bottom: 8px; border-radius: 12px;
      border: 1px solid #eee; background: #fdfdfd; font-weight: 600; text-align: left;
    }
    .scene-btn.active { background: #fff9e6; border-color: var(--brand-yellow); }
    .accordion-button:not(.collapsed) { background-color: #f5fff9; color: var(--brand-green); }

    body.welcome-visible #bottomControls { display: none; }
  </style>
</head>

<body class="welcome-visible">

  <header class="topbar">
    <div class="brand">
      <div class="brand-badge">T</div>
      <div>Tour Interactivo — Udenar Túquerres</div>
    </div>
    <button id="btnMenu" data-bs-toggle="offcanvas" data-bs-target="#nav">
      <i class="bi bi-list fs-4"></i>
    </button>
  </header>

  <section id="welcome">
    <div class="welcome-card">
      <span class="badge rounded-pill bg-success px-3 py-2 mb-3">BIENVENIDO</span>
      <h2 class="fw-bold">Sede Regional Túquerres</h2>
      <p class="text-muted">Explora nuestras instalaciones en una experiencia 360° interactiva.</p>
      <button class="btn-enter" onclick="enterTour('entrada')">
        <i class="bi bi-play-fill me-1"></i> COMENZAR TOUR
      </button>
    </div>
  </section>

  <div id="panoramaWrap">
    <div id="panorama"></div>
    <div id="bottomControls">
      <button id="btnHomeBottom" class="ctrl-btn" onclick="goHome()">
        <i class="bi bi-house"></i> Inicio
      </button>
      <button id="btnBackBottom" class="ctrl-btn" onclick="goBack()">
        <i class="bi bi-arrow-left"></i> Volver
      </button>
    </div>
  </div>

  <div class="offcanvas offcanvas-end" id="nav" tabindex="-1">
    <div class="offcanvas-header border-bottom">
      <h5 class="fw-bold mb-0"><i class="bi bi-compass me-2"></i>Navegación</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      
      <button class="scene-btn w-100 mb-4 active" data-scene="entrada" onclick="jumpFromMenu('entrada')">
        <span><i class="bi bi-house-door me-2"></i> Vista Principal</span>
        <i class="bi bi-chevron-right"></i>
      </button>

      <div class="accordion" id="navAcc">
        <div class="accordion-item border-0 mb-2">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collB1">
              Bloque 1 (Aulas / Biblio)
            </button>
          </h2>
          <div id="collB1" class="accordion-collapse collapse" data-bs-parent="#navAcc">
            <div class="accordion-body p-1">
              <button class="scene-btn" data-scene="bloque1" onclick="jumpFromMenu('bloque1')">Pasillo Principal</button>
              <button class="scene-btn" data-scene="biblio" onclick="jumpFromMenu('biblio')">Biblioteca</button>
              <button class="scene-btn" data-scene="h_studio" onclick="jumpFromMenu('h_studio')">Home Studio</button>
              <button class="scene-btn" data-scene="e1_s1" onclick="jumpFromMenu('e1_s1')">Aula 1</button>
              <button class="scene-btn" data-scene="b1_s2" onclick="jumpFromMenu('b1_s2')">Aula 2</button>
            </div>
          </div>
        </div>

        <div class="accordion-item border-0 mb-2">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collB2">
              Bloque 2 (Informática)
            </button>
          </h2>
          <div id="collB2" class="accordion-collapse collapse" data-bs-parent="#navAcc">
            <div class="accordion-body p-1">
              <button class="scene-btn" data-scene="bloque2" onclick="jumpFromMenu('bloque2')">Entrada Bloque 2</button>
              <button class="scene-btn" data-scene="e2_p1_info1" onclick="jumpFromMenu('e2_p1_info1')">Informática 1</button>
              <button class="scene-btn" data-scene="e2_p1_info2" onclick="jumpFromMenu('e2_p1_info2')">Informática 2</button>
              <button class="scene-btn" data-scene="e2_p2" onclick="jumpFromMenu('e2_p2')">Piso 2 (Aulas)</button>
            </div>
          </div>
        </div>

        <div class="accordion-item border-0 mb-2">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collB3">
              Bloque 3 (Laboratorios)
            </button>
          </h2>
          <div id="collB3" class="accordion-collapse collapse" data-bs-parent="#navAcc">
            <div class="accordion-body p-1">
              <button class="scene-btn" data-scene="bloque3" onclick="jumpFromMenu('bloque3')">Cancha / General</button>
              <button class="scene-btn" data-scene="e3_auditorio" onclick="jumpFromMenu('e3_auditorio')">Auditorio</button>
              <button class="scene-btn" data-scene="e3_p1" onclick="jumpFromMenu('e3_p1')">Piso 1 (Cafetería)</button>
              <button class="scene-btn" data-scene="e3_p4" onclick="jumpFromMenu('e3_p4')">Piso 4 (Pasillo Lab)</button>
              <button class="scene-btn" data-scene="e3_p4_lab1" onclick="jumpFromMenu('e3_p4_lab1')">Lab. Química</button>
              <button class="scene-btn" data-scene="e3_p4_lab2" onclick="jumpFromMenu('e3_p4_lab2')">Lab. Biología</button>
              <button class="scene-btn" data-scene="e3_p4_lab3" onclick="jumpFromMenu('e3_p4_lab3')">Lab. Física</button>
            </div>
          </div>
        </div>
      </div>

      <button class="scene-btn w-100 mt-3" data-scene="plazoleta" onclick="jumpFromMenu('plazoleta')">
        <span><i class="bi bi-tree me-2"></i> Plazoleta Central</span>
      </button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

  <script>
    let viewer;
    const historyStack = [];

    function addImageWithLabel(hotSpotDiv, args) {
      hotSpotDiv.classList.add('custom-image-hotspot');
      const img = document.createElement('img');
      img.src = args.icon || 'pin.png';
      hotSpotDiv.appendChild(img);
      if(args.label) {
        const label = document.createElement('div');
        label.className = 'hotspot-label';
        label.innerText = args.label;
        hotSpotDiv.appendChild(label);
      }
    }

    function updateControls() {
      const backBtn = document.getElementById('btnBackBottom');
      const isWelcome = document.body.classList.contains('welcome-visible');
      if (!isWelcome && historyStack.length > 1) {
        backBtn.style.display = 'inline-flex';
      } else {
        backBtn.style.display = 'none';
      }
    }

    function load(sceneId, push = true) {
      if (push) {
        const last = historyStack[historyStack.length - 1];
        if (last !== sceneId) historyStack.push(sceneId);
      }
      viewer.loadScene(sceneId);
      updateControls();
      document.querySelectorAll('.scene-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.scene === sceneId);
      });
    }

    function goBack() {
      if (historyStack.length > 1) {
        historyStack.pop();
        const prev = historyStack[historyStack.length - 1];
        load(prev, false);
      }
    }

    function goHome() {
      document.body.classList.add('welcome-visible');
      document.getElementById('welcome').style.display = 'grid';
      historyStack.length = 0;
      updateControls();
    }

    function enterTour(sceneId) {
      document.body.classList.remove('welcome-visible');
      document.getElementById('welcome').style.display = 'none';
      load(sceneId);
    }

    function jumpFromMenu(sceneId) {
      const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('nav'));
      if(offcanvas) offcanvas.hide();
      load(sceneId);
    }

    const config = {
      default: { 
        firstScene: "entrada", autoLoad: true, sceneFadeDuration: 1000, 
        showControls: false, hfov: 110 
      },
      scenes: {
        "entrada": {
          title: "Entrada Principal", panorama: "entrada.jpeg",
          hotSpots: [
            { pitch: -38, yaw: 12, type: "custom", cssClass: "custom-image-hotspot", 
              createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "BLOQUE 1", icon: "ico1.png" },
              clickHandlerFunc: () => load("bloque1") },
            { pitch: -20, yaw: 3, type: "custom", cssClass: "custom-image-hotspot",
              createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "BLOQUE 2", icon: "ico2.png" },
              clickHandlerFunc: () => load("bloque2") },
            { pitch: -15, yaw: 28, type: "custom", cssClass: "custom-image-hotspot",
              createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "BLOQUE 3", icon: "ico3.png" },
              clickHandlerFunc: () => load("bloque3") },
            { pitch: -25, yaw: -18, type: "custom", cssClass: "custom-image-hotspot",
              createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "PLAZOLETA", icon: "icoplaza.png" },
              clickHandlerFunc: () => load("plazoleta") }
          ]
        },
        "bloque1": {
          title: "B1: Pasillo", panorama: "bloque1.jpg",
          hotSpots: [
            { pitch: 0, yaw: 41, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "BIBLIOTECA", icon: "icobiblio.png" }, clickHandlerFunc: () => load("biblio") },
            { pitch: -11, yaw: 41, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "HOME STUDIO", icon: "icohome.png" }, clickHandlerFunc: () => load("h_studio") },
            { pitch: -3, yaw: -5, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Aulas", icon: "icoaula.png" }, clickHandlerFunc: () => load("b1_pasillo") }
          ]
        },
        "biblio": { title: "Biblioteca", panorama: "biblioteca.jpg", hotSpots: [{ pitch: -10, yaw: 0, type: "info", text: "Área de estudio" }] },
        "h_studio": { 
          title: "Home Studio", panorama: "homestudio.jpg",
          hotSpots: [{ pitch: -10, yaw: 160, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "YouTube", icon: "icoyoutube.png" }, clickHandlerFunc: () => window.open("https://youtube.com", "_blank") }] 
        },
        "b1_pasillo": {
          title: "B1: Pasillo Aulas", panorama: "pasillo2_b1.jpg",
          hotSpots: [
            { pitch: -2, yaw: -150, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Aula 1", icon: "icoaula.png" }, clickHandlerFunc: () => load("e1_s1") },
            { pitch: -2, yaw: 100, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Aula 2", icon: "icoaula.png" }, clickHandlerFunc: () => load("b1_s2") }
          ]
        },
        "e1_s1": { title: "Aula 1", panorama: "b1s1.jpg", hotSpots: [] },
        "b1_s2": { title: "Aula 2", panorama: "b1s2.jpg", hotSpots: [] },
        "bloque2": {
          title: "Bloque 2", panorama: "bloque2.jpg",
          hotSpots: [
            { pitch: -15, yaw: -11, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Informática 1", icon: "icoaulainfo.png" }, clickHandlerFunc: () => load("e2_p1_info1") },
            { pitch: -15, yaw: 6, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Informática 2", icon: "icoaulainfo.png" }, clickHandlerFunc: () => load("e2_p1_info2") },
            { pitch: 5, yaw: -45, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Piso 2", icon: "icosubir.png" }, clickHandlerFunc: () => load("e2_p2") }
          ]
        },
        "e2_p1_info1": { title: "Informática 1", panorama: "ainfo1.jpg", hotSpots: [] },
        "e2_p1_info2": { title: "Informática 2", panorama: "ainfo2.jpg", hotSpots: [] },
        "e2_p2": { title: "B2: Piso 2", panorama: "b2piso2.jpg", hotSpots: [] },
        "bloque3": {
          title: "Bloque 3", panorama: "bloque3.jpg",
          hotSpots: [
            { pitch: -20, yaw: 18, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Auditorio", icon: "icoauditorio.png" }, clickHandlerFunc: () => load("e3_auditorio") },
            { pitch: 0, yaw: 170, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Piso 1", icon: "arrow1.png" }, clickHandlerFunc: () => load("e3_p1") }
          ]
        },
        "e3_auditorio": { title: "Auditorio", panorama: "auditorio.jpg", hotSpots: [] },
        "e3_p1": { 
          title: "B3: Piso 1", panorama: "cafeteria.jpg", 
          hotSpots: [
            { pitch: 5, yaw: 0, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Subir Labs", icon: "icosubir.png" }, clickHandlerFunc: () => load("e3_p4") }
          ] 
        },
        "e3_p4": {
          title: "B3: Pasillo Laboratorios", panorama: "bloque3p4.jpg",
          hotSpots: [
            { pitch: 0, yaw: 63, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Química", icon: "icoquimica.png" }, clickHandlerFunc: () => load("e3_p4_lab1") },
            { pitch: 4, yaw: 76, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Biología", icon: "icobiologia.png" }, clickHandlerFunc: () => load("e3_p4_lab2") },
            { pitch: 6, yaw: 165, type: "custom", createTooltipFunc: addImageWithLabel, createTooltipArgs: { label: "Física", icon: "icofisica.png" }, clickHandlerFunc: () => load("e3_p4_lab3") }
          ]
        },
        "e3_p4_lab1": { title: "Lab. Química", panorama: "labquimica.jpg", hotSpots: [] },
        "e3_p4_lab2": { title: "Lab. Biología", panorama: "labbiologia.jpg", hotSpots: [] },
        "e3_p4_lab3": { title: "Lab. Física", panorama: "labfisica.jpg", hotSpots: [] },
        "plazoleta": { title: "Plazoleta Central", panorama: "plazoleta.jpg", hotSpots: [] }
      }
    };

    viewer = pannellum.viewer('panorama', config);
    document.addEventListener('DOMContentLoaded', updateControls);
  </script>
</body>
</html>